<!DOCTYPE html>
<html>
  <head>
    <title>heyME</title>
	
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8"></script>
  <script src="jquery.min.js"></script>
<script src="jquery.Jcrop.min.js"></script>

<script type="text/javascript">

    
 var jcrop_api;
function setCrop()
    {
        
 jcrop_api = $.Jcrop('#can_model', { aspectRatio: 1,
              minSize: 50, onChange: showCoords,    onSelect: showCoords, bgColor: '#CCC' });
 }
 
  function showCoords(c)
  {
      // variables can be accessed here as
   //  alert(c.x, c.y, c.x2, c.y2, c.w, c.h);
     $('#w').val(c.w);
    $('#h').val(c.h);
     $('#x_coor').val(c.x);
    $('#y_coor').val(c.y);
    
//context_tmp.drawImage(imageObj, c.x, c.y, c.w, c.h, 0, 0, canvas.width, canvas.height);
    
  };
  var pictureSource;   // picture source
    var destinationType; // sets the format of returned value
   var rotating = false; 
    document.addEventListener("deviceready",onDeviceReady,false);
     function onDeviceReady() {
       	pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
        document.addEventListener("backbutton", function (e) {
        e.preventDefault(); 
    navigator.notification.confirm("Do you want to exit meMO?", onConfirmExit, "meMO", "Yes,No");
    }, false );
    
    }
    
  function release()
  {
    	jcrop_api.destroy();
   }
  
     function start()
      {
         }
      function getPhoto(source) {
	release();
        	document.getElementById("div_main").style.display = 'none';
      
navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50,  destinationType: destinationType.FILE_URI, sourceType: source });
    }
function onPhotoURISuccess(imageURI) {
	    var c = document.getElementById("can_me");
	    var ctx = c.getContext('2d');
	    var img = new Image();
		img.onload= drawImageScaled_new.bind(null, img, ctx);
		img.src = imageURI;
   }
   
   function drawImageScaled_new(img, ctx) {
   var c = ctx.canvas ;
   document.getElementById("div_main").style.display = 'none';
   
 c_width=document.getElementById("w").value;
 c_height=document.getElementById("h").value;
  c.width=c_width;
  c.height=c_height;
  ctx.clearRect(0,0,c.width,c.height);
   ctx.drawImage(img,0,0,img.width,img.height,0,0,c.width,c.height);
   //context.drawImage(imageObj,0,0,imageObj.width,imageObj.height,0,0,canvas.width,canvas.height);
  imgData2=ctx.getImageData(0,0,c.width,c.height);
 }
 function onFail(message) {
  //    alert('Failed because: ' + message);
    }
    
    function onConfirmExit(button) {
    if(button==2){ //If User select a No, then return back;
        return;
    }else{
    	if (navigator.app) {
            navigator.app.exitApp();
        }
        else if (navigator.device) {
            navigator.device.exitApp();
        }
       // navigator.app.exitApp(); // If user select a Yes, quit from the app.
    }
}
var ctr=0;
function overlay()
{
	document.getElementById("div_main").style.display = 'none';
		document.getElementById("div_main2").style.display = 'none';
		
	canvas_final = document.getElementById("can_final");
               context_final = canvas_final.getContext("2d");
               canvas_final.height = window.innerHeight;
  		canvas_final.width = window.innerWidth;
  		context_final.clearRect(0,0,canvas_final.height, canvas_final.height);
               context_final.putImageData(imgData1,0,0);
               x_co=document.getElementById('x_coor').value;
             y_co=document.getElementById('y_coor').value;
              context_final.putImageData(imgData2,x_co,y_co);
           overlay_action();
}
function overlay_action()
{
	      if(ctr==0)
	      {
	      	canvas=document.getElementById("can_final");
	       ctx = canvas.getContext('2d');
	      }
	      else
	       {
	    //   	document.getElementById("div_main3").style.display = 'block';
	     // 	alert("second");
	      //	canvas=document.getElementById("can_touchup");
	       // ctx = canvas.getContext('2d');
	      }
		
		if (ctx) {
            // React to mouse events on the canvas, and mouseup on the entire document
            canvas.addEventListener('mousedown', sketchpad_mouseDown, false);
            canvas.addEventListener('mousemove', sketchpad_mouseMove, false);
            window.addEventListener('mouseup', sketchpad_mouseUp, false);
            // React to touch events on the canvas
            canvas.addEventListener('touchstart', sketchpad_touchStart, false);
            canvas.addEventListener('touchmove', sketchpad_touchMove, false);
        }	
}
function drawDot(x1,y1){
	if(ctr==1)
	{
	//	drawDot1(x1,y1);
	//	break;
	}
	else if(ctr==2)
	{
	//	echoColor();
	}
	else
	{
      ctx.clearRect(0,0,canvas.width, canvas.height);
      ctx.putImageData(imgData1,0,0);
      ctx.putImageData(imgData2,x1,y1);
	}
}
     function sketchpad_mouseDown() {
        mouseDown=1;
        drawDot(mouseX,mouseY);
    }
       function sketchpad_mouseUp() {
        mouseDown=0;
    }
    function sketchpad_mouseMove(e) { 
        // Update the mouse co-ordinates when moved
        getMousePos(e);
        // Draw a dot if the mouse button is currently being pressed
        if (mouseDown==1) {
            drawDot(mouseX,mouseY);
        }
    }
    function getMousePos(e) {
        if (!e)
            var e = event;
        if (e.offsetX) {
            mouseX = e.offsetX;
            mouseY = e.offsetY;
        }
        else if (e.layerX) {
            mouseX = e.layerX;
            mouseY = e.layerY;
        }
     }
     function sketchpad_touchStart() {
        // Update the touch co-ordinates
        getTouchPos();
        drawDot(touchX,touchY);
        // Prevents an additional mousedown event being triggered
        event.preventDefault();
    }
    function sketchpad_touchMove(e) { 
        // Update the touch co-ordinates
        getTouchPos(e);
        // During a touchmove event, unlike a mousemove event, we don't need to check if the touch is engaged, since there will always be contact with the screen by definition.
        drawDot(touchX,touchY); 
        // Prevent a scrolling action as a result of this touchmove triggering.
        event.preventDefault();
    }
    function getTouchPos(e) {
        if (!e)
            var e = event;
        if(e.touches) {
            if (e.touches.length == 1) { // Only deal with one finger
                var touch = e.touches[0]; // Get the information for finger #1
                touchX=touch.pageX-touch.target.offsetLeft;
                touchY=touch.pageY-touch.target.offsetTop;
            }
        }
    }

function loadModelPhoto()
{
	
	 var canvas = document.getElementById('can_model');
      var context = canvas.getContext('2d');
      var imageObj = new Image();

      imageObj.onload = function() {
        context.drawImage(imageObj, 69, 50);
      };
      imageObj.src = 'http://www.html5canvastutorials.com/demos/assets/darth-vader.jpg';
}
    
    function m_getPhoto(source) {

      navigator.camera.getPicture(onPhotoURISuccess_m, onFail, { quality: 50,destinationType: destinationType.FILE_URI,sourceType: source });
    }
   
    function onFail(message) {
 //     alert('Failed because: ' + message);
    }
    function onPhotoURISuccess_m(imageURI1) {
	    var c = document.getElementById("can_model");
	    var ctx = c.getContext('2d');
	    var img = new Image();
		img.onload= drawImageScaled.bind(null, img, ctx);
		img.src = imageURI1;
   }
   function drawImageScaled(img, ctx) {
	
 var canvas = ctx.canvas ;
  canvas.height = window.innerHeight;
  canvas.width = window.innerWidth;
   ctx.clearRect(0,0,canvas.width, canvas.height);
   ctx.drawImage(img,0,0,canvas.width,canvas.height);
   imgData1=ctx.getImageData(0,0,canvas.width, canvas.height);
 // setCrop();
  
}
      </script>
      <link rel="stylesheet" href="jquery.Jcrop.min.css" type="text/css" />
      <style type="text/css">
        .jcrop-holder div
        {
          -webkit-border-radius: 50% !important;
          -moz-border-radius: 50% !important;
          border-radius: 50% !important;
        }
        .btncss
	{
	background:none;
	border:none;
	padding:0;
	cursor:pointer;
	font: 8pt arial;
	font-family:Oswald, sans-serif; /*Oswald is available from http://www.google.com/webfonts/specimen/Oswald*/
	color: #b32d5f;
	}
	.canvasStyle
	{ 
     position: absolute; 
       }
        .divStyle{
   width: 100%;
   height: 100%;
   overflow-y: scroll;
  
  }
  .divStyle2{
   width: 100%;
   height: 100%;
   overflow-y: scroll;
  
  }
  .divStyle1{
   width: 100%;
   height: 100%;
   overflow-y: scroll;
  
  }
      </style>
  </head>
  <body>
      <div class="container">
        <div>
<table><tr><td colspan=2><input type="text" id='w'></td>
<td><input type="text" id='h'></td>
<td><input type="text" id='x_coor'></td>
<td><input type="text" id='y_coor'></td></tr>
</table>
<button onclick="m_getPhoto(pictureSource.PHOTOLIBRARY);">Load Model Photo</button>
        	<button onclick="setCrop();">Crop</button>
        	<button onclick="getPhoto(pictureSource.PHOTOLIBRARY);">Upload Your Photo</button>
        	<button onclick="overlay();" class="btncss">Overlap</button>
          <input type="text" id="coords" style="width:500px;">
          </div>
          
          <div class="divStyle" id="div_main">
<canvas id="can_model" style="border:0px solid white;"></canvas>
        
        </div>
        <div class="divStyle2" id="div_main2">
<canvas id="can_me" style="border:0px solid white;"></canvas>
</div>
<div class="divStyle1" id="div_main1">
<canvas id="can_final" style="border:0px solid white;"></canvas>
</div>

      </div>
      
  </body>
</html>
