<!DOCTYPE html>
<html>
  <head>
    <title>heyME</title>
	
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="jquery.min.js"></script>
<script src="jquery.Jcrop.min.js"></script>

<link rel="stylesheet" href="jquery.Jcrop.min.css" type="text/css" />

<script type="text/javascript">
  var tmr=0; 
  var filName;
  var jcrop_api;
 var c_width;
 var c_height;
 var imgData1,imgData2,imgData3;
 var mul_img1,mul_img2,mul_img3;
 var x_co,y_co;
 var ctr=0;
 var canvas,ctx;
 var touchup=false;
 var ip;
 
function setCrop()
    {
        
 jcrop_api = $.Jcrop('#target', { aspectRatio: 1,
              minSize: 50, onChange: showCoords,    onSelect: showCoords, bgColor: '#CCC' });
 }
 
  function showCoords(c)
  {
      // variables can be accessed here as
   //  alert(c.x, c.y, c.x2, c.y2, c.w, c.h);
     $('#w').val(c.w);
    $('#h').val(c.h);
     $('#x_coor').val(c.x);
    $('#y_coor').val(c.y);
  };

  var img_arr = new Array(5);
  var new_imgArr=new Array(5);
   
var ik=0;

var pictureSource;   // picture source
    var destinationType; // sets the format of returned value
   var rotating = false; 
    document.addEventListener("deviceready",onDeviceReady,false);
     function onDeviceReady() {
       	pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
  }
    
  function release()
  {
    //	jcrop_api.destroy();
   }
  
     function start()
      {
        	 document.getElementById("tbl").style.width=window.innerHeight;
        	 document.getElementById("target").style.visibility = 'hidden';
        	 document.getElementById("div_main1").style.visibility = 'hidden';
        	 document.getElementById("div_main2").style.visibility = 'hidden';
        	 document.getElementById("div_main3").style.visibility = 'hidden';
        	 
	  }
       function onFail(message) {
  //    alert('Failed because: ' + message);
    }
 

    
    function m_getPhoto(source) {
   // document.getElementById("crop").disabled = false; 
      navigator.camera.getPicture(m_onPhotoURISuccess, onFail, { quality: 50,destinationType: destinationType.FILE_URI,sourceType: source });
    }
   
    
    function m_onPhotoURISuccess(imageURI1) {
    	var c = document.getElementById("can_model");
	    var ctx = c.getContext('2d');
	 var img = new Image();
		img.src = imageURI1;
		document.getElementById("target").src=imageURI1;
		document.getElementById("target").style.visibility = 'visible';
		img.onload= drawImageScaled.bind(null, img, ctx);
	    }
function onConfirm(buttonIndex) {
  if(buttonIndex==1)
  {
    setCrop();
	}
}		
   function drawImageScaled(img, ctx) {
	
 var canvas = ctx.canvas ;
canvas.height = img.height;
 canvas.width = img.width;
   ctx.clearRect(0,0,canvas.width, canvas.height);
   ctx.drawImage(img,0,0,canvas.width,canvas.height);
   imgData1=ctx.getImageData(0,0,canvas.width, canvas.height);
   for(i=0;i<=400;i++)
   {
   	//do something
   }
navigator.notification.confirm('Ready to select the face part!',  onConfirm,  'Face Dimensions', ['OK','Cancel'] );
  
}
function release()
  {
    	jcrop_api.destroy();
  }
   
   
   function getPhoto(source) {
   //	document.getElementById("crop").disabled = true; 
   	release();
   	
    	document.getElementById("target").style.visibility = 'hidden';
    	document.getElementById("target").style.display = 'none';
    	document.getElementById("can_model").style.visibility = 'hidden';
    	document.getElementById("div_main1").style.display = 'none';
    	document.getElementById("div_main2").style.display = 'block';
    	document.getElementById("div_main2").style.visibility = 'visible';
      navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50,destinationType: destinationType.FILE_URI,sourceType: source });
    }
    function onPhotoURISuccess(imageURI) {
    	    var c = document.getElementById("can_me");
	    var ctx = c.getContext('2d');
	    var img1 = new Image();
		img1.onload= drawImageScaled_new.bind(null, img1, ctx);
		img1.src = imageURI;
   }
   function drawImageScaled_new(img2, ctx) {
    var c = ctx.canvas ;
  c_width=document.getElementById("w").value;
 c_height=document.getElementById("h").value;
  c.width=c_width;
  c.height=c_height;
   ctx.clearRect(0,0,c.width,c.height);
   ctx.drawImage(img2,0,0,img2.width,img2.height,0,0,c.width,c.height);
   imgData2=ctx.getImageData(0,0,c.width,c.height);
  }
 
 function disp()
 {
 	release();
 	document.getElementById("target").style.visibility = 'hidden';
    	document.getElementById("target").style.display = 'none';
    	
 window.imagePicker.getPictures(
                function(results) {
                    for (var i = 0; i < results.length; i++) {
                    		img_arr[i]= results[i]; 
		window.resolveLocalFileSystemURI(results[i], function(fileEntry){	
        	fileEntry.file(function(fileObj) { document.getElementById('fnam').value=document.getElementById('fnam').value+"#"+fileEntry.name;
      //alert(document.getElementById('fnam').value);      
      // alert ('i  '+i); // alert(fileObj.size);          //  alert(fileObj.type);      
            }); 
    }, function (error) {            alert('Error: ' + error);        });
                    }
                  
                }, function (error) {                    alert('Error: ' + error);                }
            );
            document.getElementById("main").style.display = 'block';
    	document.getElementById("main").style.visibility = 'visible';
    	
    	var img_r = document.createElement('img');
	img_r.src = img_arr[0];
	document.getElementById('loadImgDiv1').appendChild(img_r);
	
	var img_r1 = document.createElement('img');
	img_r1.src = img_arr[1];
	document.getElementById('loadImgDiv2').appendChild(img_r1);
	
	var img_r2 = document.createElement('img');
	img_r2.src = img_arr[2];
	document.getElementById('loadImgDiv3').appendChild(img_r2);
	
     }
 

function prep()
{
    	
   	var img_r = document.createElement('img');
	img_r.src = img_arr[0];
	document.getElementById('loadImgDiv1').appendChild(img_r);
	
	var img_r1 = document.createElement('img');
	img_r1.src = img_arr[1];
	document.getElementById('loadImgDiv2').appendChild(img_r1);
	
	var img_r2 = document.createElement('img');
	img_r2.src = img_arr[2];
	document.getElementById('loadImgDiv3').appendChild(img_r2);
	
//	alert("Select a pic");
	
	
}
function testDiv1()
{
//	alert("selected");
//	alert(img_arr[0]);
	document.getElementById("div_main2").style.display = 'block';
    	document.getElementById("div_main2").style.visibility = 'visible';
    	
    	c_width=document.getElementById("w").value;
 	c_height=document.getElementById("h").value;

    	c = document.getElementById("can_me");
	ctx = c.getContext('2d');
	ctx.clearRect(0,0,c.width,c.height);
	var img_1 = document.createElement('img');
	img_1.src = img_arr[0];
	img_1.x=0;
    	img_1.y=0;
   // 	img_1.style.width=c_width;
    //	img_1.style.height=c_height;
    	alert(c_width);
    	
    	ctx.drawImage(img_1,img_1.x,img_1.y);
 }
 function testDiv2()
{
	alert("selected");
//	alert(img_arr[0]);

    	
    	document.getElementById("div_main2").style.display = 'block';
    	document.getElementById("div_main2").style.visibility = 'visible';
    	
    	c_width=document.getElementById("w").value;
 	c_height=document.getElementById("h").value;

    	c = document.getElementById("can_me");
	ctx = c.getContext('2d');
	var img_1 = document.createElement('img');
	img_1.src = img_arr[1];
	img_1.x=0;
    	img_1.y=0;
    //	img_1.style.width=c_width;
    //	img_1.style.height=c_height;
    	ctx.clearRect(0,0,c.width,c.height);
    	ctx.drawImage(img_1,img_1.x,img_1.y,c_width,c_height);
 }
 
 function testDiv3()
{
	alert("selected");
//	alert(img_arr[0]);
	
   
    	
    	document.getElementById("div_main2").style.display = 'block';
    	document.getElementById("div_main2").style.visibility = 'visible';
    	
    	c_width=document.getElementById("w").value;
 	c_height=document.getElementById("h").value;

    	c = document.getElementById("can_me");
	ctx = c.getContext('2d');
	ctx.clearRect(0,0,c.width,c.height);
	var img_1 = document.createElement('img');
	img_1.src = img_arr[2];
	img_1.x=0;
    	img_1.y=0;
    //	img_1.style.width=c_width;
    //	img_1.style.height=c_height;
    	ctx.drawImage(img_1,img_1.x,img_1.y,c_width,c_height);
 }
 



      </script>

      <style type="text/css">
        .jcrop-holder div
        {
          -webkit-border-radius: 50% !important;
          -moz-border-radius: 50% !important;
          border-radius: 50% !important;
        }
      
  .cropImage{
  visibility:hidden;
  position:fixed;
  }
  .btncss
	{
	background:none;
	border:none;
	padding:0;
	cursor:pointer;
	font: 8pt arial;
	font-family:Oswald, sans-serif; /*Oswald is available from http://www.google.com/webfonts/specimen/Oswald*/
	color: #b32d5f;
	}
.divStyle1{
   width: 100%;
   height: 100%;
   overflow-y: scroll;
   visibility:hidden;
   position:fixed;
  }
  .divStyle2{
   width: 100%;
   height: 100%;
   
   visibility:hidden;
   position:fixed;
  }
  .divStyle3{
   width: 100%;
   height: 100%;
   
   visibility:hidden;
   position:fixed
  }
  .red {
    background:red;
    border-color:black;
}

.blue {
    display:inline-block;
    margin-right: -4px;
    box-sizing: border-box;
    padding: 1%;
    background:blue;
    border-color:black;
     visibility:hidden;
}



.main{
   background-color: red;
    height: 50px;
    width: 150px;
    visibility:hidden;	
}

.bottom{
    position: relative;
    top:0px;
    left:0px;
    height: 50px;
    width: 50px;
    background-color: green;
    color: white;
    float: left;
    margin-right: 0px;
}

        </style>
  </head>
  
      
        
<body onload="start();">
      <div class="container">
        <div>
          <table id="tbl" cellspacing="0" cellpadding="0">
          	<tr><td colspan=5><input type="text" id='fnam'></td></tr>
       	<tr><td><input type="text" size="3" id='w'></td><td><input type="hidden" id='h' size="3" ></td><td><input type="hidden"  size="3" id='x_coor'></td><td><input type="hidden"  size="3" id='y_coor'></td><td>&nbsp;</td></tr>
         <tr><td><button onclick="m_getPhoto(pictureSource.PHOTOLIBRARY);">Load M </button></td>
         <td><button onclick="disp();">Load Y</button></td>
         <!--<td><button id="me_photo" onclick="getPhoto(pictureSource.PHOTOLIBRARY);">Load Y</button></td>-->
         <td><button onclick="testDiv1();">Overlay</button></td>
         <td><button id="Position" onclick="overlay_action();">Position</button></td>
         <!--<td><button onclick="touchUp();">Touchup</button></td>-->
         </tr></table>
         </div>
         <div class="main"><div class="bottom" id='loadImgDiv1'  onclick="testDiv1();>#1   </div>    <div class="bottom" id='loadImgDiv2'  onclick="testDiv2();">#2  </div> <div class="bottom" id='loadImgDiv3'  onclick="testDiv3();">#3   </div></div>
              	 <!--	<div id='loadImgDiv1'  onclick="testDiv1();">&nbsp;</div>
    			<div id='loadImgDiv2'  onclick="testDiv2();">&nbsp;<div>
    			<div id='loadImgDiv3'  onclick="testDiv3();">&nbsp;</div>-->	
         
         	<Br><br>
         <div>            <img src="splash.png" class="cropImage" id="target" alt="jCrop Circle Area Example" /></div>
            <div class="divStyle1" id="div_main1"><canvas id="can_model" style="border:0px solid white;"></canvas></div>
            <div class="divStyle2" id="div_main2"><canvas id="can_me" style="border:2px solid red;"></canvas></div>
            <div class="divStyle3" id="div_main3"><canvas id="can_final" style="border:0px solid white;"></canvas></div>
        
      </div>
      
  </body>
</html>
